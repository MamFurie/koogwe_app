// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  PASSENGER
  DRIVER
  ADMIN
}

enum RideStatus {
  REQUESTED
  ACCEPTED
  ARRIVED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// ✅ FIX BUG 2 : Ajout enum VehicleType
enum VehicleType {
  MOTO
  ECO
  CONFORT
}

model User {
  id                String   @id @default(uuid())
  email             String   @unique
  name              String?
  password          String
  phone             String?
  role              Role     @default(PASSENGER)
  isVerified        Boolean  @default(false)
  verificationToken String?
  createdAt         DateTime @default(now())

  driverProfile     DriverProfile?
  ridesAsPassenger  Ride[]   @relation("PassengerRides")
  ridesAsDriver     Ride[]   @relation("DriverRides")
}

model DriverProfile {
  id            String  @id @default(uuid())
  userId        String  @unique
  user          User    @relation(fields: [userId], references: [id])
  vehicleMake   String?
  vehicleModel  String?
  vehicleColor  String?
  licensePlate  String?
}

model Ride {
  id          String      @id @default(uuid())

  passengerId String
  passenger   User        @relation("PassengerRides", fields: [passengerId], references: [id])

  driverId    String?
  driver      User?       @relation("DriverRides", fields: [driverId], references: [id])

  originLat   Float
  originLng   Float
  destLat     Float
  destLng     Float

  price       Float

  // ✅ FIX BUG 2 : vehicleType stocké en BDD
  vehicleType VehicleType @default(MOTO)

  status      RideStatus  @default(REQUESTED)
  createdAt   DateTime    @default(now())
}
